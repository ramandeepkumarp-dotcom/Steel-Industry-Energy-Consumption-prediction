<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Steel Energy Usage Predictor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root { --bg:#f7f8fb; --card:#fff; --text:#222; --muted:#666; --primary:#2a6cf6; }
    body { margin:0; font-family: Inter, Arial, sans-serif; background:var(--bg); color:var(--text); }
    .container { max-width: 980px; margin: 40px auto; padding: 0 16px; }
    .card { background:var(--card); border-radius:12px; box-shadow:0 10px 25px rgba(0,0,0,0.07); padding:24px; }
    h1 { margin:0 0 8px; }
    .subtitle { color:var(--muted); margin-bottom:24px; }
    .grid { display:grid; grid-template-columns: repeat(2, minmax(260px, 1fr)); gap:16px; }
    label { font-weight:600; font-size:14px; margin-bottom:6px; display:block; }
    input, select { width:100%; padding:10px 12px; border:1px solid #dfe3ea; border-radius:8px; font-size:14px; }
    .section-title { margin-top:24px; margin-bottom:8px; font-size:16px; font-weight:700; }
    .actions { display:flex; gap:12px; margin-top:20px; }
    button { background:var(--primary); color:#fff; border:none; border-radius:8px; padding:12px 16px; font-weight:600; cursor:pointer; }
    button.secondary { background:#e9edf7; color:#1d2b4f; }
    .result { margin-top:20px; background:#eef4ff; border:1px solid #d7e3ff; border-radius:10px; padding:12px 16px; }
    .footer { margin-top:20px; color:var(--muted); font-size:13px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Steel Energy Usage Predictor</h1>
      <div class="subtitle">Predict <strong>Usage_kWh</strong> from operational, environmental, and temporal features.</div>

      <div class="section-title">Numeric features</div>
      <div class="grid">
        <div>
          <label>Lagging_Current_Reactive.Power_kVarh</label>
          <input id="lagging_reactive" type="number" step="0.1" value="50">
        </div>
        <div>
          <label>Leading_Current_Reactive_Power_kVarh</label>
          <input id="leading_reactive" type="number" step="0.1" value="5">
        </div>
        <div>
          <label>CO2(tCO2)</label>
          <input id="co2" type="number" step="0.00001" value="0.02">
        </div>
        <div>
          <label>Lagging_Current_Power_Factor</label>
          <input id="lag_pf" type="number" min="0" max="1" step="0.01" value="0.85">
        </div>
        <div>
          <label>Leading_Current_Power_Factor</label>
          <input id="lead_pf" type="number" min="0" max="1" step="0.01" value="0.10">
        </div>
        <div>
          <label>NSM (seconds from midnight)</label>
          <input id="nsm" type="number" min="0" max="86400" step="60" value="32400">
        </div>
        <div>
          <label>Hour</label>
          <input id="hour" type="number" min="0" max="23" value="10">
        </div>
        <div>
          <label>Month</label>
          <input id="month" type="number" min="1" max="12" value="6">
        </div>
        <div>
          <label>is_weekend (0/1)</label>
          <select id="is_weekend">
            <option value="0" selected>0</option>
            <option value="1">1</option>
          </select>
        </div>
      </div>

      <div class="section-title">Categorical features</div>
      <div class="grid">
        <div>
          <label>WeekStatus (0=Weekend, 1=Weekday)</label>
          <select id="weekstatus">
            <option value="1" selected>1</option>
            <option value="0">0</option>
          </select>
        </div>
        <div>
          <label>Day_of_week (0=Mon â€¦ 6=Sun)</label>
          <select id="day_of_week">
            <option>0</option><option>1</option><option>2</option>
            <option selected>3</option><option>4</option><option>5</option><option>6</option>
          </select>
        </div>
        <div>
          <label>Load Type (optional)</label>
          <input id="load_type" type="text" value="">
        </div>
      </div>

      <div class="actions">
        <button id="predictBtn">Predict Usage_kWh</button>
        <button class="secondary" id="resetBtn">Reset</button>
      </div>

      <div id="result" class="result" style="display:none;"></div>
      <div class="footer">Note: Hour is used to compute cyclical encodings (hour_sin, hour_cos) before prediction.</div>
    </div>
  </div>

  <script>
    function toNumber(el) {
      const v = el.value;
      return v === "" ? null : Number(v);
    }

    document.getElementById('resetBtn').addEventListener('click', () => {
      document.getElementById('lagging_reactive').value = 50;
      document.getElementById('leading_reactive').value = 5;
      document.getElementById('co2').value = 0.02;
      document.getElementById('lag_pf').value = 0.85;
      document.getElementById('lead_pf').value = 0.10;
      document.getElementById('nsm').value = 32400;
      document.getElementById('hour').value = 10;
      document.getElementById('month').value = 6;
      document.getElementById('is_weekend').value = 0;
      document.getElementById('weekstatus').value = 1;
      document.getElementById('day_of_week').value = 3;
      document.getElementById('load_type').value = "";
      document.getElementById('result').style.display = 'none';
    });

    document.getElementById('predictBtn').addEventListener('click', async () => {
      const hour = toNumber(document.getElementById('hour'));
      const hourRad = 2 * Math.PI * (hour / 24.0);
      const hourSin = Math.sin(hourRad);
      const hourCos = Math.cos(hourRad);

      const payload = {
        "Lagging_Current_Reactive.Power_kVarh": toNumber(document.getElementById('lagging_reactive')),
        "Leading_Current_Reactive_Power_kVarh": toNumber(document.getElementById('leading_reactive')),
        "CO2(tCO2)": toNumber(document.getElementById('co2')),
        "Lagging_Current_Power_Factor": toNumber(document.getElementById('lag_pf')),
        "Leading_Current_Power_Factor": toNumber(document.getElementById('lead_pf')),
        "NSM": toNumber(document.getElementById('nsm')),
        "hour_sin": hourSin,
        "hour_cos": hourCos,
        "month": toNumber(document.getElementById('month')),
        "is_weekend": toNumber(document.getElementById('is_weekend')),
        "WeekStatus": toNumber(document.getElementById('weekstatus')),
        "Day_of_week": toNumber(document.getElementById('day_of_week')),
        "Load Type": document.getElementById('load_type').value
      };

      try {
        const res = await fetch('/predict', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!res.ok) throw new Error('Network response was not ok');
        const data = await res.json();
        const resultEl = document.getElementById('result');
        resultEl.style.display = 'block';
        resultEl.innerHTML = `<strong>Predicted Usage_kWh:</strong> ${Number(data.prediction).toFixed(2)}<br><span class="subtitle">Model: Preprocessor + Selected Regressor</span>`;
      } catch (err) {
        const resultEl = document.getElementById('result');
        resultEl.style.display = 'block';
        resultEl.innerHTML = `<strong>Error:</strong> ${err.message}`;
      }
    });
  </script>
</body>
</html>